# Dynamic JSON and CSV Templates Walkthrough

I have refactored the `default.json.php` and `default.csv.php` templates to implement dynamic field mapping. This approach automatically includes page fields based on their content and blueprint, rather than relying on a hardcoded list.

## Key Changes

### 1. Dynamic Field Mapping
The templates now:
- Discover all content fields from the page.
- Check the field type in the blueprint (e.g., `pages`, `files`, `structure`, `date`, `toggle`, `tags`, `multiselect`).
- Apply type-specific formatting (e.g., resolving page titles/URLs, formatting dates, flattening structures).
- Automatically omit empty fields from the output.

### 2. Header and Data Consistency (CSV)
For CSV exports, the template now:
- Scans all rows (children or the page itself) to collect every unique non-empty field key.
- Generates a consistent header row based on these keys.
- Ensures every data row matches the header structure, filling in empty values where fields are missing.

### 3. Browser Display (Preview Mode)
As requested, the `Content-Disposition: attachment` header has been commented out. 
- Accessing `.json` or `.csv` links will now display the data directly in the browser.
- This is useful for quick inspection and debugging.

## How to Verify

1. **Test JSON Export**:
   - Open any page in your browser (e.g., a collection page or a single event).
   - Append `.json` to the URL.
   - Verify that all filled fields are present and correctly formatted.

2. **Test CSV Export**:
   - Append `.csv` to the same URL.
   - Verify that the browser displays a comma-separated list of values.
   - Verify that the headers match the data columns.

### Specific Logic Maintained
The template still follows the established architecture:
- If a page has **listed children**, it exports a list of data for all children.
- If a page has **no listed children**, it exports the data for the page itself.

Additionally, the `risposte_form` and `num_max` fields are still calculated dynamically using `CollectionHelper::getFormData` if applicable.

---
render_diffs(file:///Users/ff3300/Desktop/SITI/k5-spazio13/site/templates/default.json.php)
render_diffs(file:///Users/ff3300/Desktop/SITI/k5-spazio13/site/templates/default.csv.php)
